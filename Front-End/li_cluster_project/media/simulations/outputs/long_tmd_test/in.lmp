# TMD simulation using spring forces toward target
units metal
atom_style atomic
boundary f f f

# Read initial structure
read_data input.data

# Li-Li interactions using Lennard-Jones potential
pair_style lj/cut 10.0
pair_coeff 1 1 0.05 2.5

# Define atom groups
group mobile id > 0

# Energy minimization
minimize 1.0e-4 1.0e-6 1000 10000

# Initialize velocities with very low temperature for stability
velocity mobile create 10.0 4928459 rot yes dist gaussian

# TMD implementation using individual spring forces  
# Read target coordinates and apply spring force for each atom
variable k_spring equal 1.0  # Much weaker spring for gradual transition

# Apply spring forces toward target positions for each atom
# We'll use individual fix spring commands for each atom
group atom1 id 1
fix spring1 atom1 spring tether ${k_spring} 0.000000 0.000000 0.000000 0.0
group atom2 id 2
fix spring2 atom2 spring tether ${k_spring} 2.500000 0.000000 0.000000 0.0
group atom3 id 3
fix spring3 atom3 spring tether ${k_spring} 1.250000 2.165000 0.000000 0.0

# Multi-stage temperature control for gradual equilibration
# Stage 1: Gentle equilibration at low temperature
fix nvt_fix1 mobile nvt temp 10.0 10.0 10.0

# Output trajectory every 50 steps for longer simulation
dump traj_dump all xyz 50 trajectory.xyz
dump_modify traj_dump element Li

# Thermodynamics output more frequently to monitor
thermo_style custom step temp press etotal pe ke
thermo 100

# Stage 1: Short equilibration with weak springs
timestep 0.001
run 5000

# Stage 2: Longer TMD with temperature reduction
unfix nvt_fix1
fix nvt_fix2 mobile nvt temp 10.0 1.0 20.0
run 15000

# Stage 3: Final equilibration at very low temperature  
unfix nvt_fix2
fix nvt_fix3 mobile nvt temp 1.0 1.0 20.0
run 10000

# Cleanup springs
unfix spring1
unfix spring2
unfix spring3

# Final cleanup
unfix nvt_fix3
undump traj_dump
